sap.ui.define(["sap/ui/core/Control","jquery.sap.global","./3rd/enketo"],function(e,t,r){"use strict";var i=e.extend("odsmfe.FormUI.control.EnketoForm",{metadata:{properties:{formHTMLStr:{type:"string",defaultValue:""},modelStr:{type:"string",defaultValu+
e:""},formRecord:{type:"string",defaultValue:""},formID:{type:"string",defaultValue:""},mode:{type:"string",defaultValue:""}},aggregations:{_busyIndicator:{type:"sap.m.BusyDialog",multiple:false,visibility:"hidden"}},events:{enketoFormSubmit:{parameters:+
{formRecord:{type:"string"},isDraft:{type:"string"},files:{type:"string"}}}}},init:function(){var e=new sap.m.BusyDialog;e.setText("Please wait ..");this.setAggregation("_busyIndicator",e)},renderer:function(e,t){e.write('<div id="EnketoFormControl" clas+
s="main">');e.write("<style scoped>");e.write('@import "./lib/css/grid.css"');e.write("</style>");e.write('<article class="paper">');e.write('<header class="form-header clearfix">');e.write('\t\t<span class="form-language-selector hide"><span>Choose Lang+
uage</span></span>');e.write('\t\t<nav class="pages-toc hide" role="navigation">');e.write('\t\t\t<label for="toc-toggle"></label>');e.write('\t\t\t<input type="checkbox" id="toc-toggle" class="ignore" value="show">');e.write('\t\t\t<ul class="pages-toc_+
_list"></ul>');e.write('\t\t\t<div class="pages-toc__overlay"></div>');e.write("\t\t</nav>");e.write("</header>");e.write('<div id="EnketoFormBody">');e.write("</div>");e.write('<div id="EnketoFormSubmit">');e.write("</div>");e.write("</article>");e.writ+
e("</div>")},setFormID:function(e){this.setProperty("formID",e,true)},setMode:function(e){this.setProperty("mode",e,true)},setFormHTMLStr:function(e){var t='<div style="background-color:lightblue">'+"<h6>"+"Form "+this.getFormID()+" is loading"+"</h6></d+
iv>";$("#EnketoFormBody").html(t);this.getAggregation("_busyIndicator").open();this.setProperty("formHTMLStr",e,true);this.getAggregation("_busyIndicator").close()},rerender:function(){this.getAggregation("_busyIndicator").close();var e=this.getFormHTMLS+
tr();var t=new sap.m.BusyDialog;if(e){t.open();this._setHTMLForm();this._initializeForm();t.close()}else{}},onBeforeRendering:function(){},onAfterRendering:function(){if(e.prototype.onAfterRendering){e.prototype.onAfterRendering.apply(this,arguments)}if(+
!this.isRendered){}},_setHTMLForm:function(){var e="<div >"+this.getFormHTMLStr()+"</div>";$("#EnketoFormBody").html(e);var t=this.getMode();var r;var i=document.getElementById("EnketoFormControl");if(t==="Edit"){r='<div class="form-footer"><button id="s+
ave-as-draft">Save As Draft</button><button id="validate-form">Submit</button></div>';$("#EnketoFormSubmit").html(r);i.classList.remove("lock")}else if(t==="Create"){r='<div class="form-footer"><button id="save-as-draft">Save As Draft</button><button id=+
"validate-form">Submit</button></div>';$("#EnketoFormSubmit").html(r);i.classList.remove("lock")}else if(t==="Display"){var i=document.getElementById("EnketoFormBody");r="<div ></div>";$("#EnketoFormSubmit").html(r);i.classList.add("mainBody");i.classLis+
t.toggle("lock")}},getFilename:function(e,t){var r;if(typeof e==="object"&&e!==null&&e.name){t=t||"";r=e.name.split(".");if(r.length>1){r[r.length-2]+=t}else if(r.length===1){r[0]+=t}return r.join(".")}return""},getCurrentFiles:function(e){var t=this;var+
 r=500;var i=[];$("form.or").find('input[type="file"]:not(.ignore), input[type="text"][data-drawing="true"]').each(function(){var e;var r=null;var o=null;if(this.type==="file"){r=this.files[0]}else if(this.value){o=$(this).closest(".question")[0].querySe+
lector(".draw-widget canvas");if(o){r=t.dataUriToBlobSync(o.toDataURL());r.name=this.value}}if(r&&r.name){e=t.getFilename(r,this.dataset.filenamePostfix);r=new Blob([r],{type:r.type});r.name=e;i.push(r)}});return i},dataUriToBlobSync:function(e){var t;va+
r r;var i;var o;t=atob(e.split(",")[1]);r=e.split(",")[0].split(":")[1].split(";")[0];i=new ArrayBuffer(t.length);o=new Uint8Array(i);for(var n=0;n<t.length;n++){o[n]=t.charCodeAt(n)}return new Blob([o],{type:r})},urlToBlob:function(e){const t=new XMLHtt+
pRequest;return new Promise(r=>{t.open("GET",e);t.responseType="blob";t.onload=(()=>{r(t.response)});t.send()})},_initializeForm:function(){try{var e=new r("form.or:eq(0)",{modelStr:this.getModelStr(),instanceStr:this.getFormRecord(),submitted:true},{arc+
Gis:{basemaps:["streets","topo","satellite","osm"],webMapId:"f2e9b762544945f390ca4ac3671cfa72",hasZ:true},clearIrrelevantImmediately:true});var t=e.init();if(t.length>0){}var i=this;$("#validate-form").on("click",function(){e.validate().then(function(t){+
if(!t){window.alert("Form contains errors. Please see fields marked in red.")}else{$("form.or").trigger("beforesave");i.fireEvent("enketoFormSubmit",{formRecord:e.getDataStr(),isDraft:null,files:i.getCurrentFiles()})}})});$("#save-as-draft").on("click",f+
unction(){$("form.or").trigger("beforesave");i.fireEvent("enketoFormSubmit",{formRecord:e.getDataStr(),isDraft:"X",files:i.getCurrentFiles()})})}catch(e){e.message="errors occured in rendering the given FormHTML and Model";alert(e.message)}},setValue:fun+
ction(e){},_onSubmit:function(e){var t=this.getModel("i18n").getResourceBundle();this.fireEvent("enketoFormSubmit",{formRecord:this.getFormRecord()})}});return i});                                                                                           