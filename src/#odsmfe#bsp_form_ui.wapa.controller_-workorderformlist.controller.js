sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/Fragment","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/Sorter","sap/ui/core/format/DateFormat","sap/ui/Device","odsmfe/FormUI/model/formatter","sap/m/MessageBox","sap/ui/core/r+
outing/History","sap/ui/core/UIComponent","sap/ui/core/ValueState","sap/ui/model/odata/v2/ODataModel","sap/m/MessageToast","sap/m/GroupHeaderListItem"],function(e,t,r,o,i,n,a,s,u,d,l,g,m,p,c){"use strict";return e.extend("odsmfe.FormUI.controller.WorkOrd+
erFormList",{formatter:s,_WorkOrderNumber:null,_OrderType:null,_FormMetaDataID:null,_FormMetaDataVersion:null,_oDialog:null,_fromCreate:false,_oEditDialog:null,_dateFormat:n.getDateInstance({pattern:"dd/MM/YYYY hh:mm"}),onInit:function(){var e=sap.ui.cor+
e.UIComponent.getRouterFor(this);e.getRoute("TargetWorkOrderFormList").attachMatched(this.__onRouteMatched,this)},__onRouteMatched:function(e){var t=this;this._WorkOrderNumber=e.getParameter("arguments").WorkOrderNumber;var r=this.getView().getModel("app+
");var o=r.getProperty("/selectedOrderType");if(this._WorkOrderNumber===null||typeof this._WorkOrderNumber==="undefined"){var i=r.getProperty("/selectedWorkOrder");this._WorkOrderNumber=i}else{var i=r.getProperty("/selectedWorkOrder");if(!i){r.setPropert+
y("/selectedWorkOrder",this._WorkOrderNumber)}}if(this._OrderType===null||typeof this._OrderType==="undefined"){var o=r.getProperty("/selectedOrderType");this._OrderType=o}else{var o=r.getProperty("/selectedOrderType");if(!o){r.setProperty("/selectedOrde+
rType",this._OrderType)}}var n="/WorkOrderSet(WorkOrderNumber='"+this._WorkOrderNumber+"',"+"OrderType='"+this._OrderType+"')";this.getView().bindElement({path:n,events:{dataRequested:function(){t.getView().setBusy(true)},dataReceived:function(){t.getVie+
w().setBusy(false)}}})},onExit:function(){},getFormID:function(e){return e.getProperty("FormID")},getVersion:function(e){return e.getProperty("Version")},getGroupHeader:function(e){return new c({title:e.key,upperCase:false})},onCloseDetailPress:function(+
){var e=this.getView().getModel("app");e.setProperty("/actionButtonsInfo/midColumn/fullScreen",false);this.getOwnerComponent().getRouter().navTo("TargetWorkOrderList",{},true)},toggleFullScreen:function(){var e=this.getView().getModel("app");var t=e.getP+
roperty("/actionButtonsInfo/midColumn/fullScreen");e.setProperty("/actionButtonsInfo/midColumn/fullScreen",!t);if(!t){e.setProperty("/previousLayout",e.getProperty("/layout"));e.setProperty("/layout","MidColumnFullScreen")}else{e.setProperty("/layout",e.+
getProperty("/previousLayout"))}},onViewDisplayForm:function(e){var t=e.getParameter("listItem");var r=t.getBindingContext().getProperty("InstanceID");var o="Display";var i=this.getView().getModel("app");i.setProperty("/selectedFormInstanceID",r);i.setPr+
operty("/selectedMode",o);this.getOwnerComponent().getRouter().navTo("TargetForm",{FormInstanceID:r,Mode:o},true)},onEditForm:function(e){var t=e.getSource();var r=t.getBindingContext();var o=r.getObject();var i=o.InstanceID;var n="Edit";var a=this.getVi+
ew().getModel("app");a.setProperty("/selectedFormInstanceID",i);a.setProperty("/selectedMode",n);this.getOwnerComponent().getRouter().navTo("TargetForm",{FormInstanceID:i,Mode:n},true)},onCreateForm:function(e){var r=e.getSource();var o=this;if(!this._oD+
ialog){t.load({name:"odsmfe.FormUI.view.fragment.dialog.AvailableFormsDialog",controller:this}).then(function(e){this._oDialog=e;this._oDialog.setModel(this.getView().getModel());this.getView().addDependent(this._oDialog);this._configDialog(r);this._oDia+
log.open()}.bind(this))}else{this._oDialog.setModel(this.getView().getModel());this.getView().addDependent(this._oDialog);this._configDialog(r);this._oDialog.open()}},_configDialog:function(e){var t=e.data("confirmButtonText");this._oDialog.setConfirmBut+
tonText("Create")},onDialogClose:function(e){var t=e.getParameter("selectedContexts");if(t&&t.length){var r=t.map(function(e){return e.getObject().FormId});var o=t.map(function(e){return e.getObject().Version});var i=t.map(function(e){return e.getObject(+
).Submitted});var n=t.map(function(e){return e.getObject().Occurances});var a=t.map(function(e){return e.getObject().MultipleSub});console.log("Create Form"+r);var s=this.getView().getModel("app");s.setProperty("/selectedWorkOrder",this._WorkOrderNumber)+
;s.setProperty("/selectedOrderType",this._OrderType)}else{p.show("No new item was selected.",{duration:3e3,width:"30em"})}e.getSource().getBinding("items").filter([]);var u=new sap.ui.model.type.Integer({minIntegerDigits:3});var d=new sap.ui.model.type.I+
nteger({minIntegerDigits:3});u=parseInt(i[0]);d=parseInt(n[0]);var l="Create";if(a="X"){if(u<d||d==0){this.getOwnerComponent().getRouter().navTo("TargetFormCreate",{WorkOrder:this._WorkOrderNumber,FormMetaDataID:r[0],Version:o[0],Mode:l},true)}else{p.sho+
w("No more submissions allowed for the FormID:"+r[0]+"     "+"Version:"+o[0],{duration:6e3,width:"60em"})}}else{if(u<"1"){this.getOwnerComponent().getRouter().navTo("TargetFormCreate",{WorkOrder:this._WorkOrderNumber,FormMetaDataID:r[0],Version:o[0],Mode+
:l},true)}else{p.show("No more submissions allowed for the FormID:"+r[0]+"Version:"+o[0],{duration:6e3,width:"60em"})}}},onUpdateFinished:function(e){var t=this.getView().getModel("data");t.setProperty("/FormList/count",e.getSource().getBinding("items").+
getLength());var r=0;var o=0;var i=e.getSource().getBinding("items").getContexts();var n=this.getView().byId("tableWorkOrderFormList");var a=[];for(var s=0;s<n.getItems().length;s++){if(n.getItems()[s]){if(n.getItems()[s].isGroupHeader()==false){a.push(n+
.getItems()[s])}}}var s=0;i.forEach(function(e){var t=e.getObject();var r=t.OperationNum;var o=t.Equipment;var i=t.FunctionLocation;var n=null;if(t.OperationNum){n="Assigned to Operation: "+t.OperationNum}else if(t.Equipment){n="Assigned to Equipment: "++
t.Equipment}else if(t.FunctionLocation){n="Assigned to FunctionLocation: "+t.FunctionLocation}if(a[s]){if(a[s].isGroupHeader()==false){a[s].getCells()[0].setText(n)}}s++})}})});                                                                              